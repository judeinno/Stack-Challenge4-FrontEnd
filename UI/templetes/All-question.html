<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Title</title>
        <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0">
        <link rel="stylesheet" type="text/css" href="../static/main.css">
        <script src="../scripts/nav.js"></script>
    </head>
    <body>
        <div id = "logo">
                <h1>StackOverFlow-lite</h1>
        </div>
        <div class="nav" id="mynav">
              <a href="User-home-page.html" class="active">Home</a>
              <a href="All-question.html">All questions</a>
              <a href="signin.html">Sign Out</a>
              <a href="javascript:void(0);" class="icon" onclick="myFunction()">
                More
              </a>
        </div>
        <div class="content">
            <div class="ask-question">
                <section>
                    <form id="askQuestion" action="index.html">
                      <label>Find question</label><br>
                        <label>
                            <input id="Question" type="text" name="question" placeholder="Your question">
                        </label><br>
                      <input id ="submit-question" type="submit" value="Submit">
                    </form>
                </section>
            </div>
            <div id="questions">
                <div class="container">
                    <div class="row no-collapse-1">
                        <section class="specific-question">
                            <div id="questionslist" class="actual-question"></div>

                        </section>

                    </div>

                </div>
            </div>
        </div>
        <div>
            <footer id="footer">
                <p class="slogan"><br><br><br>StackOverFlow-lite, Ask anything!</p>
                <p>2018 StackOverFlow-lite</p>
            </footer>
        </div>
        <script>

            document.getElementById("askQuestion").addEventListener("submit", questionPost);
            document.getElementById("questionslist").addEventListener("load", getQuestions());
            token = localStorage.getItem('token')

            function questionPost(e) {
                e.preventDefault();
                let Question = document.getElementById("Question").value;
                console.log(Question);
                data = {
                    'Question': Question,
                };
                let  url = "http://127.0.0.1:5000/api/v1/questions";
                fetch(url, {
                    method: "post",
                    body: JSON.stringify(data),
                    headers: {
                        "Accept": "application/json, text/plain, */*",
                        "Content-Type": "application/json",
                        "Authorization":` Bearer ${token}`
                    }
                })
                .then(res => res.json())
                .then(response => {
                    console.log(response)
                    if (response.message === "Token has expired") {
                        alert('Token has expired');
                        window.location.replace('signin.html');}
                    else if (response.message === 'Question already exists, please ask another question') {
                        alert("Question already exists, please ask another question");
                        window.location.replace('All-question.html');
                    }
                    else if (response.message === 'Invalid, Please enter a valid question') {
                        alert("Invalid, Please enter a valid question");
                        window.location.replace('All-question.html');
                    }
                    else if (response.message === 'You have successfully asked a question') {
                        alert("You have successfully asked a question");
                        window.location.replace('All-question.html');
                    }

                }
                )
                .catch(error => console.error("Error:", error));
            }
            function getQuestions(){
                fetch('http://127.0.0.1:5000/api/v1/questions')
                .then((res) => res.json())
                .then((data) => {
                    let output = '<h2>Questions</h2>';
                    console.log(data)
                    data.forEach(function(post){
                        output += `
                        <ul class="questions">
                            <li><a href = "Single-question.html?questionId=${post.qn_id}">Question No ${post.qn_id};  ${post.Question}</a></li>
                        </ul>
                        <hr>
                    `;
                    });
                    document.getElementById('questionslist').innerHTML = output;
                })
            }

        </script>
        <script>

        </script>
    </body>
</html>